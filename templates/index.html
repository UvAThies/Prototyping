<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Rescue Turtle Control</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    </head>
    <body onload="javascript:mc_init()">
        <a class="action-button shadow animate blue unselectable" onmousedown='playsound()' onmouseup='stopsound()'>Play Sound</a>
<span id="gps">NO FIX</span>

        <div id="joystick-R"></div>
        <div id="joystick-L"></div>


        <div id="video-container">
            <img src="http://turtle.local:8081">
        </div>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.js" integrity="sha512-luMnTJZ7oEchNDZAtQhgjomP1eZefnl82ruTH/3Oj/Yu5qYtwL7+dVRccACS/Snp1lFXq188XFipHKYE75IaQQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.10.2/nipplejs.js" integrity="sha512-WkQoRWCoNX6HLaYdCCKUS3QfVk6Yk3U7gTgX22yil7QY91pFsBFzTVjhdbXoOLayLHeTre5sZNchk/5SO7FNdg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script>
            function mc_init(){
                socket = io.connect('http://'+document.domain+':'+location.port);
                socket.on('rsp', function(data){
                    console.log(data['status']);
                });

                startGPS();
            }

            function getGPSData() {
                socket.emit('gps', (data) => {
                    console.log('GPS ack');
                    console.log(data);
                    document.getElementById('gps').innerHTML = JSON.stringify(data);
                });
            }

            function startGPS(){
                setInterval(getGPSData, 1000);
            }

            function move(btn){
                socket.emit('req', {'direction': btn.id, 'speed': '100'});
                return false;
            }
            function stop(){
                socket.emit('req', {'direction': 'STOP', 'speed': '0'});
                return false;
            }
            function playsound(){
                socket.emit('req', {'sound': 'PLAY'});
                return false;
            }
            function stopsound(){
                socket.emit('req', {'sound': 'STOP'});
                return false;
            }
        </script>
        <script>
            var joyR = nipplejs.create({
                zone: document.getElementById('joystick-R'),
                mode: 'static',
                position: {right: '10rem', bottom: '10rem'},
                color: 'white',
                size: 200,
            });
            var joyL = nipplejs.create({
                zone: document.getElementById('joystick-L'),
                mode: 'static',
                position: {left: '10rem', bottom: '10rem'},
                color: 'white',
                size: 120,
            });

            joyR.on('move', function (evt, data){
                socket.emit('req', {'joy_x': data.vector.x, 'joy_y': data.vector.y});
            });
            joyR.on('end', function (evt){
                socket.emit('req', {'stop': true})
            });

            joyL.on('move', function (evt, data){
                socket.emit('servo', {'angle': data.angle.degree});
            });
        </script>
    </body>
</html>